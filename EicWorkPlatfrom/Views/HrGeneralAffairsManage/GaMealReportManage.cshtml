<div class="panel panel-primary" ng-controller="reportMealManageCtrl">
    <div class="panel-heading">
        <h6 class="panel-title"><i class="fa fa-pencil-square-o"></i>报餐管理</h6>
    </div>
    <div class="panel-body">
        <div class="bs-callout bs-callout-default">
            <div class="row">
                <div class="col-md-12">
                    <form class="form-inline" onkeypress="if (event.keyCode === 13) return false;">
                        <div class="form-group">
                            <div class="btn-group">
                                <button type="button" ng-class="{true:'btn btn-warning',false:'btn btn-default'}[vmManager.reportMealType==='员工餐']"
                                        ng-click="vmManager.selectReportMealType('员工餐')">
                                    <i class="fa fa-user"></i> 员工餐
                                </button>
                                <button type="button" ng-class="{true:'btn btn-warning',false:'btn btn-default'}[vmManager.reportMealType==='陆干餐']"
                                        ng-click="vmManager.selectReportMealType('陆干餐')">
                                    <i class="fa fa-user-secret"></i>陆干餐
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <div yl-month-button
                                 data-yearmonth="qryvm.yearMonth"
                                 year="qryvm.year"
                                 month="qryvm.month"
                                 changed="vmManager.loadCalendarDatas()"
                                 title-visible="true"></div>
                        </div>
                        <div class="form-group">
                            <div class="input-group">
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-primary" ng-model="vmManager.department"
                                            data-html="1" data-multiple="0" data-animation="am-flip-x" data-placeholder="选择部门"
                                            data-bs-options="item.DepartmentText as item.DepartmentText for item in vmManager.organizationUnits" data-bs-select>
                                        选择部门 <span class="caret"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" ng-if="vmManager.reportMealType==='陆干餐'">
                            <label class="control-label">工号</label>
                            <span yl-workerid-input data-changed="vmManager.setLeaderMealReportDatas()"
                                  data-worker="vmManager.workerInfo"></span>
                            <span style="margin-top:5px;margin-bottom:1px;padding-bottom:3px;padding-left:3px;padding-right:3px;
                                          border-radius:3px;border-bottom-style:groove;" ng-if="vmManager.workerInfo">
                                <span title="工号" class="label label-info">{{vmManager.workerInfo.WorkerId}}</span>
                                <span title="姓名" class="label label-success">{{vmManager.workerInfo.Name}}</span>
                                <span title="部门" class="label label-warning">{{vmManager.workerInfo.Department}}</span>
                                <span title="岗位" class="label label-primary">{{vmManager.workerInfo.Post}}</span>
                            </span>
                        </div>
                        <div class="form-group" ng-if="vmManager.dbDataSet.length>0">
                            <button class="btn btn-success" ng-click="operate.saveAll()"><i class="fa fa-save"></i>批量保存</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="bs-callout bs-callout-info" cg-busy="{promise:promise}">
                <div ng-if="vmManager.reportMealType==='员工餐'">
                    <div bs-tabs bs-active-pane="vmManager.activeYGTab">
                        <div bs-pane data-title="业务视图" data-name="initYGTab">
                            <table class="table table-bordered" style="table-layout:fixed;margin-bottom:5px;">
                                <thead>
                                    <tr>
                                        <th ng-repeat="headerItem in vmManager.calendar.WeekDays" class="text-center info">
                                            {{headerItem.Day}}({{headerItem.ChineseDayOfWeek}})
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="data in vmManager.calendar.WeekCalendars">
                                        <td style="background:#d9edf7;text-align:center">
                                            {{data.Week}}
                                        </td>
                                        <td style="padding-left:5px;padding-right:0;text-align:left;"
                                            ng-repeat="item in data.WeekDays"
                                            title="{{item.Title}}">
                                            <div class="pull-left">
                                                {{item.Day}}
                                                <br />
                                                <span style="font-size:12px;">{{item.ChineseCalendar}}</span>
                                                <div ng-if="item.Day!==''">
                                                    <div class="h-split"></div>
                                                    <a class="text-success" title="报餐业务办理" 
                                                       ng-click="vmManager.createEmployeeMealRecord(item)">
                                                        <i class="fa fa-calendar-plus-o"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="bs-callout bs-callout-success pull-right" title="{{item.bsData.Department}}"
                                                 ng-if="item.bsData">
                                                早餐：{{item.bsData.CountOfBreakfast}}人<br />
                                                中餐：{{item.bsData.CountOfLunch}}人<br />
                                                晚餐：{{item.bsData.CountOfSupper}}人<br />
                                                夜宵：{{item.bsData.CountOfMidnight}}人<br />
                                                <div class="h-split"></div>
                                                <span class="pull-right">
                                                    <a class="text-primary" title="编辑报餐数据" ng-click="vmManager.editEmployeeMealRecord(item,2)">
                                                        <i class="fa fa-pencil-square-o"></i>
                                                    </a>
                                                    <a class="text-danger" title="删除报餐数据" ng-click="vmManager.removeEmployeeMealRecord(item)">
                                                        <i class="fa fa-calendar-times-o"></i>
                                                    </a>
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div bs-pane data-title="数据视图" data-name="dataYGViewTab">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr class="info">
                                            <th>工号</th>
                                            <th>姓名</th>
                                            <th>部门</th>
                                            <th>早餐数量</th>
                                            <th>午餐数量</th>
                                            <th>晚餐数量</th>
                                            <th>夜宵数量</th>
                                            <th>日期</th>
                                            <th>星期</th>
                                            <th>年月份</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="item in vmManager.dbDataSet track by $index">
                                            <td>{{item.WorkerId}}</td>
                                            <td>{{item.WorkerName}}</td>
                                            <td>{{item.Department}}</td>
                                            <td>{{item.CountOfBreakfast}}</td>
                                            <td>{{item.CountOfLunch}}</td>
                                            <td>{{item.CountOfSupper}}</td>
                                            <td>{{item.CountOfMidnight}}</td>
                                            <td>{{item.ReportDay}}</td>
                                            <td>{{item.ReportDayOfWeek}}</td>
                                            <td>{{item.YearMonth}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div ng-if="vmManager.reportMealType==='陆干餐'">
                    <div bs-tabs bs-active-pane="vmManager.activeLGTab">
                        <div bs-pane data-title="业务视图" data-name="initLGTab">
                            <table class="table table-bordered" style="table-layout:fixed;margin-bottom:5px;">
                                <thead>
                                    <tr>
                                        <th ng-repeat="headerItem in vmManager.calendar.WeekDays" class="text-center info">
                                            {{headerItem.Day}}({{headerItem.ChineseDayOfWeek}})
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="data in vmManager.calendar.WeekCalendars">
                                        <td style="background:#d9edf7;text-align:center">
                                            {{data.Week}}
                                        </td>
                                        <td style="padding-left:5px;padding-right:0;text-align:left;"
                                            ng-repeat="item in data.WeekDays"
                                            title="{{item.Title}}">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="pull-left">
                                                        <span class="text-primary">{{item.Day}}</span>
                                                        <br />
                                                        <span style="font-size:12px;">{{item.ChineseCalendar}}</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-8">
                                                    <div ng-if="item.Day!==''">
                                                        <div title="{{item.bsData.WorkerName}}" style="border-left:2px solid #c4bdbd;padding-left:2px;">
                                                            <span>
                                                                中餐：<span class="text-primary" ng-if="!item.bsData.CountOfLunch>0" ng-click="vmManager.reportLeaderMealRecord(item,'中',true)"><i class="fa fa-square-o"></i></span>
                                                                <span class="text-success" ng-if="item.bsData.CountOfLunch>0" ng-click="vmManager.reportLeaderMealRecord(item,'中',false)"><i class="fa fa-check-square"></i></span>
                                                            </span>
                                                            <br />
                                                            <span>
                                                                晚餐：<span class="text-primary" ng-if="!item.bsData.CountOfSupper>0" ng-click="vmManager.reportLeaderMealRecord(item,'晚',true)"><i class="fa fa-square-o"></i></span>
                                                                <span class="text-success" ng-if="item.bsData.CountOfSupper>0" ng-click="vmManager.reportLeaderMealRecord(item,'晚',false)"><i class="fa fa-check-square"></i></span>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div bs-pane data-title="数据视图" data-name="dataLGViewTab">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr class="info">
                                            <th>工号</th>
                                            <th>姓名</th>
                                            <th>部门</th>
                                            <th>午餐数量</th>
                                            <th>晚餐数量</th>
                                            <th>日期</th>
                                            <th>星期</th>
                                            <th>年月份</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="item in vmManager.dbDataSet track by $index">
                                            <td>{{item.WorkerId}}</td>
                                            <td>{{item.WorkerName}}</td>
                                            <td>{{item.Department}}</td>
                                            <td>{{item.CountOfLunch}}</td>
                                            <td>{{item.CountOfSupper}}</td>
                                            <td>{{item.ReportDay}}</td>
                                            <td>{{item.ReportDayOfWeek}}</td>
                                            <td>{{item.YearMonth}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <dialog ng-if="employeeMealDialog.open" modal data-close="employeeMealDialog.close()" style="width:30%">
            <content dialog-title class="text-info">
                <span><i class="fa fa-paper-plane-o"></i>编辑员工报餐数据</span>
            </content>
            <content dialog-content style="width:100%;" class="bs-callout bs-callout-info">
                <form name="modalEmployeeForm" role="form" class="form-horizontal" novalidate>
                    <div class="form-group">
                        <label for="countOfBreakfast" class="col-md-3 control-label">早餐人数</label>
                        <div class="col-md-6">
                            <input type="number" name="countOfBreakfast" class="form-control" ng-model="vm.CountOfBreakfast" required />
                            <div class="error-messages" ng-messages="modalForm.countOfBreakfast.$error" ng-show="operate.showValidation">
                                <small ng-message="required">早餐人数不能为空</small>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="countOfLunch" class="col-md-3 control-label">午餐人数</label>
                        <div class="col-md-6">
                            <input type="number" name="countOfLunch" class="form-control" ng-model="vm.CountOfLunch" required />
                            <div class="error-messages" ng-messages="modalForm.countOfLunch.$error" ng-show="operate.showValidation">
                                <small ng-message="required">午餐人数不能为空</small>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="countOfSupper" class="col-md-3 control-label">晚餐人数</label>
                        <div class="col-md-6">
                            <input type="number" name="countOfSupper" class="form-control" ng-model="vm.CountOfSupper" required />
                            <div class="error-messages" ng-messages="modalForm.countOfSupper.$error" ng-show="operate.showValidation">
                                <small ng-message="required">晚餐人数不能为空</small>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="countOfMidnight" class="col-md-3 control-label">夜宵人数</label>
                        <div class="col-md-6">
                            <input type="number" name="countOfMidnight" class="form-control" ng-model="vm.CountOfMidnight" required />
                            <div class="error-messages" ng-messages="modalForm.countOfMidnight.$error" ng-show="operate.showValidation">
                                <small ng-message="required">夜宵人数不能为空</small>
                            </div>
                        </div>
                    </div>
                </form>
            </content>
            <content dialog-buttons>
                <button class="btn btn-primary" ng-click="vmManager.confirmEdit()" autofocus>确定</button>
            </content>
        </dialog>
    </div>
    <div class="panel-footer">

    </div>
</div>